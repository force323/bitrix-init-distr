
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/sale.basket.basket/templates/.default/script.min.js?150591127522417";s:6:"source";s:73:"/bitrix/components/bitrix/sale.basket.basket/templates/.default/script.js";s:3:"min";s:77:"/bitrix/components/bitrix/sale.basket.basket/templates/.default/script.min.js";s:3:"map";s:77:"/bitrix/components/bitrix/sale.basket.basket/templates/.default/script.map.js";}"*/
BasketPoolQuantity=function(){this.processing=false;this.poolQuantity={};this.updateTimer=null;this.currentQuantity={};this.lastStableQuantities={};this.updateQuantity()};BasketPoolQuantity.prototype.updateQuantity=function(){var e=BX("basket_items");if(basketJSParams["USE_ENHANCED_ECOMMERCE"]==="Y"){checkAnalytics(this.lastStableQuantities,e)}if(!!e&&e.rows.length>0){for(var t=1;e.rows.length>t;t++){var a=e.rows[t].id;this.currentQuantity[a]=BX("QUANTITY_"+a).value}}this.lastStableQuantities=BX.clone(this.currentQuantity,true)};BasketPoolQuantity.prototype.changeQuantity=function(e){var t=BX("QUANTITY_"+e).value;var a=this.isPoolEmpty();if(this.currentQuantity[e]&&this.currentQuantity[e]!=t){this.poolQuantity[e]=this.currentQuantity[e]=t}if(!a){this.enableTimer(true)}else{this.trySendPool()}};BasketPoolQuantity.prototype.trySendPool=function(){if(!this.isPoolEmpty()&&!this.isProcessing()){this.enableTimer(false);recalcBasketAjax({})}};BasketPoolQuantity.prototype.isPoolEmpty=function(){return Object.keys(this.poolQuantity).length==0};BasketPoolQuantity.prototype.clearPool=function(){this.poolQuantity={}};BasketPoolQuantity.prototype.isProcessing=function(){return this.processing===true};BasketPoolQuantity.prototype.setProcessing=function(e){this.processing=e===true};BasketPoolQuantity.prototype.enableTimer=function(e){clearTimeout(this.updateTimer);if(e===false)return;this.updateTimer=setTimeout(function(){basketPoolQuantity.trySendPool()},1500)};function updateBasketTable(e,t){var a=BX("basket_items"),i,s,l,r,n,o,_=false,u=false,c=false,d=false,p,T,f,A,b,B,y,E,m,X,v,h,I,S,k,D,N,P,C,g,U,O,R,L,Q,M,Y,x,F,w,H,K,V,j,W,G,J,q,z,Z;if(!a||typeof t!=="object"){return}i=a.rows;r=i[i.length-1];p=t.PARAMS.QUANTITY_FLOAT==="Y";if(e!==null&&!!t.BASKET_DATA){T=BX(e);s=t.BASKET_ID;Z=BX.type.isPlainObject(t.BASKET_DATA.GRID.ROWS[s]);if(Z){l=t.BASKET_DATA.GRID.ROWS[s];n=document.createElement("tr");n.setAttribute("id",t.BASKET_ID);n.setAttribute("data-item-name",l["NAME"]);n.setAttribute("data-item-brand",l[basketJSParams["BRAND_PROPERTY"]+"_VALUE"]);n.setAttribute("data-item-price",l["PRICE"]);n.setAttribute("data-item-currency",l["CURRENCY"]);r.parentNode.insertBefore(n,T.nextSibling)}if(t.DELETE_ORIGINAL==="Y"){T.parentNode.removeChild(T)}if(Z){f=n.insertCell(-1);f.setAttribute("class","margin");o=t.COLUMNS.split(",");for(A=0;A<o.length;A++){if(o[A]==="DELETE"){_=true}else if(o[A]==="DELAY"){u=true}else if(o[A]==="PROPS"){c=true}else if(o[A]==="TYPE"){d=true}}for(A=0;A<o.length;A++){switch(o[A]){case"PROPS":case"DELAY":case"DELETE":case"TYPE":break;case"NAME":b=n.insertCell(-1);B="";y="";b.setAttribute("class","itemphoto");if(l.PREVIEW_PICTURE_SRC.length>0){B=l.PREVIEW_PICTURE_SRC}else if(l.DETAIL_PICTURE_SRC.length>0){B=l.DETAIL_PICTURE_SRC}else{B=basketJSParams.TEMPLATE_FOLDER+"/images/no_photo.png"}if(l.DETAIL_PAGE_URL.length>0){y='<div class="bx_ordercart_photo_container">							<a href="'+l.DETAIL_PAGE_URL+'">								<div class="bx_ordercart_photo" style="background-image:url(\''+B+"')\"></div>							</a>						</div>"}else{y='<div class="bx_ordercart_photo_container">							<div class="bx_ordercart_photo" style="background-image:url(\''+B+"')\"></div>						</div>"}if(l.BRAND&&l.BRAND.length>0){y+='<div class="bx_ordercart_brand">							<img alt="" src="'+l.BRAND+'"/>						</div>'}b.innerHTML=y;E=n.insertCell(-1);m="";E.setAttribute("class","item");if(l["DETAIL_PAGE_URL"].length>0)m+='<h2 class="bx_ordercart_itemtitle"><a href="'+l["DETAIL_PAGE_URL"]+'">'+l["NAME"]+"</a></h2>";else m+='<h2 class="bx_ordercart_itemtitle">'+l["NAME"]+"</h2>";m+='<div class="bx_ordercart_itemart">';if(c){for(v=0;v<l["PROPS"].length;v++){h=l["PROPS"][v];if(l.SKU_DATA){X=false;for(I in l.SKU_DATA){if(l.SKU_DATA.hasOwnProperty(I)){S=l.SKU_DATA[I];if(S["CODE"]===h["CODE"]){X=true;break}}}if(X)continue}m+=BX.util.htmlspecialchars(h["NAME"])+":&nbsp;<span>"+h["VALUE"]+"</span><br/>"}}m+="</div>";if(l.SKU_DATA){G={};for(O=0;O<l["PROPS"].length;O++){R=l["PROPS"][O];G[R["CODE"]]=BX.type.isNotEmptyString(R["~VALUE"])?R["~VALUE"]:R["VALUE"]}for(I in l.SKU_DATA){if(l.SKU_DATA.hasOwnProperty(I)){J=0;S=l.SKU_DATA[I];k=false;D=BX.util.array_keys(S["VALUES"]).length>5?"full":"";q=0;for(P in S["VALUES"]){q++;N=S["VALUES"][P];if(BX.type.isNotEmptyString(G[S["CODE"]])){if(G[S["CODE"]]==N["NAME"]||G[S["CODE"]]==N["XML_ID"])J=q}if(!!N&&typeof N==="object"&&!!N["PICT"]){k=true}}z="0";if(D!=""&&J>5)z=(5-J)*20+"%";if(k){m+='<div class="bx_item_detail_scu_small_noadaptive '+D+'">';m+='<span class="bx_item_section_name_gray">'+BX.util.htmlspecialchars(S["NAME"])+"</span>";m+='<div class="bx_scu_scroller_container">';m+='<div class="bx_scu">';m+='<ul id="prop_'+S["CODE"]+"_"+l["ID"]+'" style="width: 200%; margin-left: '+z+';" class="sku_prop_list">';q=0;for(U in S["VALUES"]){q++;C=S["VALUES"][U];g=J==q?" bx_active":"";m+='<li style="width:10%;"															class="sku_prop'+g+'" 															data-sku-selector="Y" 															data-value-id="'+C["XML_ID"]+'" 															data-sku-name="'+BX.util.htmlspecialchars(C["NAME"])+'" 															data-element="'+l["ID"]+'" 															data-property="'+S["CODE"]+'"															>															<a href="javascript:void(0)" class="cnt"><span class="cnt_item" style="background-image:url('+C["PICT"]["SRC"]+'"></span></a>														</li>'}m+="</ul>";m+="</div>";m+='<div class="bx_slide_left" onclick="leftScroll(\''+S["CODE"]+"', "+l["ID"]+", "+BX.util.array_keys(S["VALUES"]).length+');"></div>';m+='<div class="bx_slide_right" onclick="rightScroll(\''+S["CODE"]+"', "+l["ID"]+", "+BX.util.array_keys(S["VALUES"]).length+');"></div>';m+="</div>";m+="</div>"}else{m+='<div class="bx_item_detail_size_small_noadaptive '+D+'">';m+='<span class="bx_item_section_name_gray">'+BX.util.htmlspecialchars(S["NAME"])+"</span>";m+='<div class="bx_size_scroller_container">';m+='<div class="bx_size">';m+='<ul id="prop_'+S["CODE"]+"_"+l["ID"]+'" style="width: 200%; margin-left: '+z+';" class="sku_prop_list">';q=0;for(U in S["VALUES"]){q++;C=S["VALUES"][U];g=J==q?" bx_active":"";m+='<li style="width:10%;"															class="sku_prop '+g+'" 															data-sku-selector="Y" 															data-value-id="'+(S["TYPE"]==="S"&&S["USER_TYPE"]==="directory"?C["XML_ID"]:BX.util.htmlspecialchars(C["NAME"]))+'" 															data-sku-name="'+BX.util.htmlspecialchars(C["NAME"])+'" 															data-element="'+l["ID"]+'" 															data-property="'+S["CODE"]+'" 															>															<a href="javascript:void(0)" class="cnt">'+BX.util.htmlspecialchars(C["NAME"])+"</a>														</li>"}m+="</ul>";m+="</div>";m+='<div class="bx_slide_left" onclick="leftScroll(\''+S["CODE"]+"', "+l["ID"]+", "+BX.util.array_keys(S["VALUES"]).length+');"></div>';m+='<div class="bx_slide_right" onclick="rightScroll(\''+S["CODE"]+"', "+l["ID"]+", "+BX.util.array_keys(S["VALUES"]).length+');"></div>';m+="</div>";m+="</div>"}}}}E.innerHTML=m;break;case"QUANTITY":L=n.insertCell(-1);Q="";M=parseFloat(l["MEASURE_RATIO"])>0?l["MEASURE_RATIO"]:1;Y=false;if(M!=0&&M!=""){x=l["QUANTITY"];l["QUANTITY"]=getCorrectRatioQuantity(l["QUANTITY"],M,p);if(x!=l["QUANTITY"]){Y=true}}L.setAttribute("class","custom");Q+="<span>"+getColumnName(t,o[A])+":</span>";Q+='<div class="centered">';Q+='<table cellspacing="0" cellpadding="0" class="counter">';Q+="<tr>";Q+="<td>";Q+='<input type="text" size="3" id="QUANTITY_INPUT_'+l["ID"]+'"											name="QUANTITY_INPUT_'+l["ID"]+'"											style="max-width: 50px"											value="'+l["QUANTITY"]+'"											onchange="updateQuantity(\'QUANTITY_INPUT_'+l["ID"]+"','"+l["ID"]+"', "+M+","+p+')"						>';Q+="</td>";if(M!=0&&M!=""){Q+='<td id="basket_quantity_control">							<div class="basket_quantity_control">								<a href="javascript:void(0);" class="plus" onclick="setQuantity('+l["ID"]+", "+M+", 'up', "+p+');"></a>								<a href="javascript:void(0);" class="minus" onclick="setQuantity('+l["ID"]+", "+M+", 'down', "+p+');"></a>							</div>						</td>'}if(l.hasOwnProperty("MEASURE_TEXT")&&l["MEASURE_TEXT"].length>0)Q+='<td style="text-align: left">'+BX.util.htmlspecialchars(l["MEASURE_TEXT"])+"</td>";Q+="</tr>";Q+="</table>";Q+="</div>";Q+='<input type="hidden" id="QUANTITY_'+l["ID"]+'" name="QUANTITY_'+l["ID"]+'" value="'+l["QUANTITY"]+'" />';L.innerHTML=Q;if(Y){updateQuantity("QUANTITY_INPUT_"+l["ID"],l["ID"],M,p)}break;case"PRICE":F=n.insertCell(-1);w=l["DISCOUNT_PRICE_PERCENT"]>0?l["FULL_PRICE_FORMATED"]:"";F.setAttribute("class","price");F.innerHTML='<div class="current_price" id="current_price_'+l["ID"]+'">'+l["PRICE_FORMATED"]+"</div>"+'<div class="old_price" id="old_price_'+l["ID"]+'">'+w+"</div>";if(d&&l["NOTES"].length>0){F.innerHTML+='<div class="type_price">'+basketJSParams["SALE_TYPE"]+"</div>";F.innerHTML+='<div class="type_price_value">'+l["NOTES"]+"</div>"}break;case"DISCOUNT":K=n.insertCell(-1);K.setAttribute("class","custom");K.innerHTML="<span>"+getColumnName(t,o[A])+":</span>";K.innerHTML+='<div id="discount_value_'+l["ID"]+'">'+l["DISCOUNT_PRICE_PERCENT_FORMATED"]+"</div>";break;case"WEIGHT":V=n.insertCell(-1);V.setAttribute("class","custom");V.innerHTML="<span>"+getColumnName(t,o[A])+":</span>";V.innerHTML+=l["WEIGHT_FORMATED"];break;default:j=n.insertCell(-1);W="";j.setAttribute("class","custom");j.innerHTML="<span>"+getColumnName(t,o[A])+":</span>";if(o[A]=="SUM")W+='<div id="sum_'+l["ID"]+'">';if(typeof l[o[A]]!="undefined"){W+=l[o[A]]}if(o[A]=="SUM")W+="</div>";j.innerHTML+=W;break}}if(_||u){var $=n.insertCell(-1);$.setAttribute("class","control");if(_)$.innerHTML='<a href="'+basketJSParams["DELETE_URL"].replace("#ID#",l["ID"])+'">'+basketJSParams["SALE_DELETE"]+"</a><br />";if(u)$.innerHTML+='<a href="'+basketJSParams["DELAY_URL"].replace("#ID#",l["ID"])+'">'+basketJSParams["SALE_DELAY"]+"</a>"}var ee=n.insertCell(-1);ee.setAttribute("class","margin")}}if(!!t.BASKET_DATA){for(H in t.BASKET_DATA.GRID.ROWS){if(t.BASKET_DATA.GRID.ROWS.hasOwnProperty(H)){var te=t.BASKET_DATA.GRID.ROWS[H];if(BX("discount_value_"+H))BX("discount_value_"+H).innerHTML=te.DISCOUNT_PRICE_PERCENT_FORMATED;if(BX("current_price_"+H))BX("current_price_"+H).innerHTML=te.PRICE_FORMATED;if(BX("old_price_"+H))BX("old_price_"+H).innerHTML=te.DISCOUNT_PRICE_PERCENT>0?te.FULL_PRICE_FORMATED:"";if(BX("sum_"+H))BX("sum_"+H).innerHTML=te.SUM;if(BX("QUANTITY_"+H)){BX("QUANTITY_INPUT_"+H).value=te.QUANTITY;BX("QUANTITY_INPUT_"+H).defaultValue=te.QUANTITY;BX("QUANTITY_"+H).value=te.QUANTITY}}}}if(!!t.BASKET_DATA)couponListUpdate(t.BASKET_DATA);if(t.hasOwnProperty("WARNING_MESSAGE")){var ae="";for(A=t["WARNING_MESSAGE"].length-1;A>=0;A--)ae+=t["WARNING_MESSAGE"][A]+"<br/>";BX("warning_message").innerHTML=ae}if(!!t.BASKET_DATA){if(BX("allWeight_FORMATED"))BX("allWeight_FORMATED").innerHTML=t["BASKET_DATA"]["allWeight_FORMATED"].replace(/\s/g,"&nbsp;");if(BX("allSum_wVAT_FORMATED"))BX("allSum_wVAT_FORMATED").innerHTML=t["BASKET_DATA"]["allSum_wVAT_FORMATED"].replace(/\s/g,"&nbsp;");if(BX("allVATSum_FORMATED"))BX("allVATSum_FORMATED").innerHTML=t["BASKET_DATA"]["allVATSum_FORMATED"].replace(/\s/g,"&nbsp;");if(BX("allSum_FORMATED"))BX("allSum_FORMATED").innerHTML=t["BASKET_DATA"]["allSum_FORMATED"].replace(/\s/g,"&nbsp;");if(BX("PRICE_WITHOUT_DISCOUNT")){var ie=t["BASKET_DATA"]["PRICE_WITHOUT_DISCOUNT"]!=t["BASKET_DATA"]["allSum_FORMATED"];BX("PRICE_WITHOUT_DISCOUNT").innerHTML=ie?t["BASKET_DATA"]["PRICE_WITHOUT_DISCOUNT"].replace(/\s/g,"&nbsp;"):"";BX.style(BX("PRICE_WITHOUT_DISCOUNT").parentNode,"display",ie?"table-row":"none")}BX.onCustomEvent("OnBasketChange")}}function couponCreate(e,t){var a="disabled";if(!BX.type.isElementNode(e))return;if(t.JS_STATUS==="BAD")a="bad";else if(t.JS_STATUS==="APPLYED")a="good";e.appendChild(BX.create("div",{props:{className:"bx_ordercart_coupon"},children:[BX.create("input",{props:{className:a,type:"text",value:t.COUPON,name:"OLD_COUPON[]"},attrs:{disabled:true,readonly:true}}),BX.create("span",{props:{className:a},attrs:{"data-coupon":t.COUPON}}),BX.create("div",{props:{className:"bx_ordercart_coupon_notes"},html:t.JS_CHECK_CODE})]}))}function couponListUpdate(e){var t,a,i,s,l,r,n,o;if(!!e&&typeof e!=="object"){return}t=BX("coupons_block");if(!!t){if(!!e.COUPON_LIST&&BX.type.isArray(e.COUPON_LIST)){i=BX("coupon");if(!!i){i.value=""}s=BX.findChildren(t,{tagName:"input",property:{name:"OLD_COUPON[]"}},true);if(!!s){if(BX.type.isElementNode(s)){s=[s]}for(r=0;r<e.COUPON_LIST.length;r++){l=false;o=-1;for(n=0;n<s.length;n++){if(s[n].value===e.COUPON_LIST[r].COUPON){l=true;o=n;s[n].couponUpdate=true;break}}if(l){a="disabled";if(e.COUPON_LIST[r].JS_STATUS==="BAD")a="bad";else if(e.COUPON_LIST[r].JS_STATUS==="APPLYED")a="good";BX.adjust(s[o],{props:{className:a}});BX.adjust(s[o].nextSibling,{props:{className:a}});BX.adjust(s[o].nextSibling.nextSibling,{html:e.COUPON_LIST[r].JS_CHECK_CODE})}else{couponCreate(t,e.COUPON_LIST[r])}}for(n=0;n<s.length;n++){if(typeof s[n].couponUpdate==="undefined"||!s[n].couponUpdate){BX.remove(s[n].parentNode);s[n]=null}else{s[n].couponUpdate=null}}}else{for(r=0;r<e.COUPON_LIST.length;r++){couponCreate(t,e.COUPON_LIST[r])}}}}t=null}function skuPropClickHandler(){var e=this,t,a,i={},s={},l,r,n,o,_;if(!!e&&e.hasAttribute("data-value-id")){BX.showWait();t=e.getAttribute("data-element");a=e.getAttribute("data-property");l=BX("action_var").value;i[a]=BX.util.htmlspecialcharsback(e.getAttribute("data-value-id"));if(BX.hasClass(e,"bx_active")){BX.closeWait();return}r=BX.findChildren(BX(t),{tagName:"ul",className:"sku_prop_list"},true);if(!!r&&r.length>0){for(n=0;r.length>n;n++){if(r[n].id!=="prop_"+a+"_"+t){o=BX.findChildren(BX(r[n].id),{tagName:"li",className:"bx_active"},true);if(!!o&&o.length>0){for(_=0;o.length>_;_++){if(o[_].hasAttribute("data-value-id")){i[o[_].getAttribute("data-property")]=BX.util.htmlspecialcharsback(o[_].getAttribute("data-value-id"))}}}}}}s={basketItemId:t,sessid:BX.bitrix_sessid(),site_id:BX.message("SITE_ID"),props:i,action_var:l,select_props:BX("column_headers").value,offers_props:BX("offers_props").value,quantity_float:BX("quantity_float").value,price_vat_show_value:BX("price_vat_show_value").value,hide_coupon:BX("hide_coupon").value,use_prepayment:BX("use_prepayment").value};s[l]="select_item";BX.ajax({url:"/bitrix/components/bitrix/sale.basket.basket/ajax.php",method:"POST",data:s,dataType:"json",onsuccess:function(e){BX.closeWait();updateBasketTable(t,e)}})}}function getColumnName(e,t){if(BX("col_"+t)){return BX.util.trim(BX("col_"+t).innerHTML)}else{return""}}function leftScroll(e,t,a){a=parseInt(a,10);var i=BX("prop_"+e+"_"+t);if(i){var s=parseInt(i.style.marginLeft,10);if(s<=-20)i.style.marginLeft=s+20+"%"}}function rightScroll(e,t,a){a=parseInt(a,10);var i=BX("prop_"+e+"_"+t);if(i){var s=parseInt(i.style.marginLeft,10);if(s>(5-a)*20)i.style.marginLeft=s-20+"%"}}function checkOut(){if(!!BX("coupon"))BX("coupon").disabled=true;BX("basket_form").submit();return true}function updateBasket(){recalcBasketAjax({})}function enterCoupon(){var e=BX("coupon");if(!!e&&!!e.value)recalcBasketAjax({coupon:e.value})}function updateQuantity(e,t,a,i){var s=BX(e).defaultValue,l=parseFloat(BX(e).value)||0,r=false,n=BX("auto_calculation")&&BX("auto_calculation").value=="Y"||!BX("auto_calculation");if(a===0||a==1){r=true}else{var o=l*1e4,_=a*1e4,u=o%_,c=parseInt(l);if(u===0){r=true}}var d=false;if(parseInt(l)!=parseFloat(l)){d=true}l=i===false&&d===false?parseInt(l):parseFloat(l).toFixed(4);l=correctQuantity(l);if(r){BX(e).defaultValue=l;BX("QUANTITY_INPUT_"+t).value=l;BX("QUANTITY_"+t).value=l;if(n){basketPoolQuantity.changeQuantity(t)}}else{l=getCorrectRatioQuantity(l,a,i);l=correctQuantity(l);if(l!=s){BX("QUANTITY_INPUT_"+t).value=l;BX("QUANTITY_"+t).value=l;if(n){basketPoolQuantity.changeQuantity(t)}}else{BX(e).value=s}}}function setQuantity(e,t,a,i){var s=parseFloat(BX("QUANTITY_INPUT_"+e).value),l;l=a=="up"?s+t:s-t;if(l<0)l=0;if(i){l=parseFloat(l).toFixed(4)}l=correctQuantity(l);if(t>0&&l<t){l=t}if(!i&&l!=l.toFixed(4)){l=parseFloat(l).toFixed(4)}l=getCorrectRatioQuantity(l,t,i);l=correctQuantity(l);BX("QUANTITY_INPUT_"+e).value=l;BX("QUANTITY_INPUT_"+e).defaultValue=l;updateQuantity("QUANTITY_INPUT_"+e,e,t,i)}function getCorrectRatioQuantity(e,t,a){var i=e*1e4,s=t*1e4,l=(e/t-(e/t).toFixed(0)).toFixed(6),r=e,n=false,o;t=parseFloat(t);if(l==0){return r}if(t!==0&&t!=1){for(o=t,max=parseFloat(e)+parseFloat(t);o<=max;o=parseFloat(parseFloat(o)+parseFloat(t)).toFixed(4)){r=o}}else if(t===1){r=e|0}if(parseInt(r,10)!=parseFloat(r)){n=true}r=a===false&&n===false?parseInt(r,10):parseFloat(r).toFixed(4);r=correctQuantity(r);return r}function correctQuantity(e){return parseFloat((e*1).toString())}function recalcBasketAjax(e){if(basketPoolQuantity.isProcessing()){return false}BX.showWait();var t={},a=BX("action_var").value,i=BX("basket_items"),s=BX("delayed_items"),l,r;l={sessid:BX.bitrix_sessid(),site_id:BX.message("SITE_ID"),props:t,action_var:a,select_props:BX("column_headers").value,offers_props:BX("offers_props").value,quantity_float:BX("quantity_float").value,price_vat_show_value:BX("price_vat_show_value").value,hide_coupon:BX("hide_coupon").value,use_prepayment:BX("use_prepayment").value};l[a]="recalculate";if(!!e&&typeof e==="object"){for(r in e){if(e.hasOwnProperty(r))l[r]=e[r]}}if(!!i&&i.rows.length>0){for(r=1;i.rows.length>r;r++)l["QUANTITY_"+i.rows[r].id]=BX("QUANTITY_"+i.rows[r].id).value}if(!!s&&s.rows.length>0){for(r=1;s.rows.length>r;r++)l["DELAY_"+s.rows[r].id]="Y"}basketPoolQuantity.setProcessing(true);basketPoolQuantity.clearPool();BX.ajax({url:"/bitrix/components/bitrix/sale.basket.basket/ajax.php",method:"POST",data:l,dataType:"json",onsuccess:function(t){BX.closeWait();basketPoolQuantity.setProcessing(false);if(e.coupon){if(!!t&&!!t.BASKET_DATA&&!!t.BASKET_DATA.NEED_TO_RELOAD_FOR_GETTING_GIFTS){BX.reload()}}if(basketPoolQuantity.isPoolEmpty()){updateBasketTable(null,t);basketPoolQuantity.updateQuantity()}else{basketPoolQuantity.enableTimer(true)}}})}function showBasketItemsList(e){BX.removeClass(BX("basket_toolbar_button"),"current");BX.removeClass(BX("basket_toolbar_button_delayed"),"current");BX.removeClass(BX("basket_toolbar_button_subscribed"),"current");BX.removeClass(BX("basket_toolbar_button_not_available"),"current");BX("normal_count").style.display="inline-block";BX("delay_count").style.display="inline-block";BX("subscribe_count").style.display="inline-block";BX("not_available_count").style.display="inline-block";if(e==2){if(BX("basket_items_list"))BX("basket_items_list").style.display="none";if(BX("basket_items_delayed")){BX("basket_items_delayed").style.display="block";BX.addClass(BX("basket_toolbar_button_delayed"),"current");BX("delay_count").style.display="none"}if(BX("basket_items_subscribed"))BX("basket_items_subscribed").style.display="none";if(BX("basket_items_not_available"))BX("basket_items_not_available").style.display="none"}else if(e==3){if(BX("basket_items_list"))BX("basket_items_list").style.display="none";if(BX("basket_items_delayed"))BX("basket_items_delayed").style.display="none";if(BX("basket_items_subscribed")){BX("basket_items_subscribed").style.display="block";BX.addClass(BX("basket_toolbar_button_subscribed"),"current");BX("subscribe_count").style.display="none"}if(BX("basket_items_not_available"))BX("basket_items_not_available").style.display="none"}else if(e==4){if(BX("basket_items_list"))BX("basket_items_list").style.display="none";if(BX("basket_items_delayed"))BX("basket_items_delayed").style.display="none";if(BX("basket_items_subscribed"))BX("basket_items_subscribed").style.display="none";if(BX("basket_items_not_available")){BX("basket_items_not_available").style.display="block";BX.addClass(BX("basket_toolbar_button_not_available"),"current");BX("not_available_count").style.display="none"}}else{if(BX("basket_items_list")){BX("basket_items_list").style.display="block";BX.addClass(BX("basket_toolbar_button"),"current");BX("normal_count").style.display="none"}if(BX("basket_items_delayed"))BX("basket_items_delayed").style.display="none";if(BX("basket_items_subscribed"))BX("basket_items_subscribed").style.display="none";if(BX("basket_items_not_available"))BX("basket_items_not_available").style.display="none"}}function deleteCoupon(){var e=this,t;if(!!e&&e.hasAttribute("data-coupon")){t=e.getAttribute("data-coupon");if(!!t&&t.length>0){recalcBasketAjax({delete_coupon:t})}}}function deleteProductRow(e){var t=BX.findParent(e,{tagName:"TR"}),a,i;if(t){a=BX("QUANTITY_"+t.id);if(a){i=getCurrentItemAnalyticsInfo(t,a.value)}}setAnalyticsDataLayer([],[i]);document.location.href=e.href;return false}function checkAnalytics(e,t){if(!e||!t||BX.util.array_values(e).length===0)return;var a,i,s={},l=[],r=[],n;if(!!t&&t.rows.length){for(n=1;t.rows.length>n;n++){a=t.rows[n].id;i=BX("QUANTITY_"+a).value-e[a];if(i!=0){s=getCurrentItemAnalyticsInfo(t.rows[n],i);if(i>0){l.push(s)}else{r.push(s)}}}}if(l.length||r.length){setAnalyticsDataLayer(l,r)}}function getCurrentItemAnalyticsInfo(e,t){if(!e)return;var a,i,s=[];var l={name:e.getAttribute("data-item-name")||"",id:e.id,price:e.getAttribute("data-item-price")||0,brand:(e.getAttribute("data-item-brand")||"").split(",  ").join("/"),variant:"",quantity:Math.abs(t)};a=e.querySelectorAll(".bx_active[data-sku-name]");for(i=0;i<a.length;i++){s.push(a[i].getAttribute("data-sku-name"))}l.variant=s.join("/");return l}function setAnalyticsDataLayer(e,t){window[basketJSParams["DATA_LAYER_NAME"]]=window[basketJSParams["DATA_LAYER_NAME"]]||[];if(e&&e.length){window[basketJSParams["DATA_LAYER_NAME"]].push({event:"addToCart",ecommerce:{currencyCode:getCurrencyCode(),add:{products:e}}})}if(t&&t.length){window[basketJSParams["DATA_LAYER_NAME"]].push({event:"removeFromCart",ecommerce:{currencyCode:getCurrencyCode(),remove:{products:t}}})}}function getCurrencyCode(){var e=BX("basket_items"),t,a="";if(e){t=e.querySelector("[data-item-currency");t&&(a=t.getAttribute("data-item-currency"))}return a}BX.ready(function(){basketPoolQuantity=new BasketPoolQuantity;var e=BX("coupons_block"),t=BX("basket_items");if(BX.type.isElementNode(e))BX.bindDelegate(e,"click",{attribute:"data-coupon"},deleteCoupon);if(BX.type.isElementNode(t))BX.bindDelegate(t,"click",{tagName:"li",attr:{"data-sku-selector":"Y"}},skuPropClickHandler);if(BX.type.isNotEmptyString(basketJSParams["EVENT_ONCHANGE_ON_START"])&&basketJSParams["EVENT_ONCHANGE_ON_START"]=="Y")BX.onCustomEvent("OnBasketChange")});
/* End */
;
; /* Start:"a:4:{s:4:"full";s:91:"/bitrix/components/bitrix/sale.gift.basket/templates/.default/script.min.js?150591127521315";s:6:"source";s:71:"/bitrix/components/bitrix/sale.gift.basket/templates/.default/script.js";s:3:"min";s:75:"/bitrix/components/bitrix/sale.gift.basket/templates/.default/script.min.js";s:3:"map";s:75:"/bitrix/components/bitrix/sale.gift.basket/templates/.default/script.map.js";}"*/
(function(t){if(!!t.JCSaleGiftBasket){return}var e=function(t){e.superclass.constructor.apply(this,arguments);this.nameNode=BX.create("span",{props:{className:"bx_medium bx_bt_button",id:this.id},text:t.text});this.buttonNode=BX.create("span",{attrs:{className:t.ownerClass},style:{marginBottom:"0",borderBottom:"0 none transparent"},children:[this.nameNode],events:this.contextEvents});if(BX.browser.IsIE()){this.buttonNode.setAttribute("hideFocus","hidefocus")}};BX.extend(e,BX.PopupWindowButton);t.JCSaleGiftBasket=function(t){this.productType=0;this.showQuantity=true;this.showAbsent=true;this.secondPict=false;this.showOldPrice=false;this.showPercent=false;this.showSkuProps=false;this.visual={ID:"",PICT_ID:"",SECOND_PICT_ID:"",QUANTITY_ID:"",QUANTITY_UP_ID:"",QUANTITY_DOWN_ID:"",PRICE_ID:"",DSC_PERC:"",SECOND_DSC_PERC:"",DISPLAY_PROP_DIV:"",BASKET_PROP_DIV:""};this.product={checkQuantity:false,maxQuantity:0,stepQuantity:1,isDblQuantity:false,canBuy:true,canSubscription:true,name:"",pict:{},id:0,addUrl:"",buyUrl:""};this.basketData={useProps:false,emptyProps:false,quantity:"quantity",props:"prop",basketUrl:""};this.defaultPict={pict:null,secondPict:null};this.checkQuantity=false;this.maxQuantity=0;this.stepQuantity=1;this.isDblQuantity=false;this.canBuy=true;this.canSubscription=true;this.precision=6;this.precisionFactor=Math.pow(10,this.precision);this.offers=[];this.offerNum=0;this.treeProps=[];this.obTreeRows=[];this.showCount=[];this.showStart=[];this.selectedValues={};this.obProduct=null;this.obQuantity=null;this.obQuantityUp=null;this.obQuantityDown=null;this.obPict=null;this.obSecondPict=null;this.obPrice=null;this.obTree=null;this.obBuyBtn=null;this.obDscPerc=null;this.obSecondDscPerc=null;this.obSkuProps=null;this.obMeasure=null;this.obPopupWin=null;this.basketUrl="";this.basketParams={};this.treeRowShowSize=5;this.treeEnableArrow={display:"",cursor:"pointer",opacity:1};this.treeDisableArrow={display:"",cursor:"default",opacity:.2};this.lastElement=false;this.containerHeight=0;this.errorCode=0;if("object"===typeof t){this.productType=parseInt(t.PRODUCT_TYPE,10);this.showQuantity=t.SHOW_QUANTITY;this.showAbsent=t.SHOW_ABSENT;this.secondPict=!!t.SECOND_PICT;this.showOldPrice=!!t.SHOW_OLD_PRICE;this.showPercent=!!t.SHOW_DISCOUNT_PERCENT;this.showSkuProps=!!t.SHOW_SKU_PROPS;this.visual=t.VISUAL;switch(this.productType){case 1:case 2:if(!!t.PRODUCT&&"object"===typeof t.PRODUCT){if(this.showQuantity){this.product.checkQuantity=t.PRODUCT.CHECK_QUANTITY;this.product.isDblQuantity=t.PRODUCT.QUANTITY_FLOAT;if(this.product.checkQuantity){this.product.maxQuantity=this.product.isDblQuantity?parseFloat(t.PRODUCT.MAX_QUANTITY):parseInt(t.PRODUCT.MAX_QUANTITY,10)}this.product.stepQuantity=this.product.isDblQuantity?parseFloat(t.PRODUCT.STEP_QUANTITY):parseInt(t.PRODUCT.STEP_QUANTITY,10);this.checkQuantity=this.product.checkQuantity;this.isDblQuantity=this.product.isDblQuantity;this.maxQuantity=this.product.maxQuantity;this.stepQuantity=this.product.stepQuantity;if(this.isDblQuantity){this.stepQuantity=Math.round(this.stepQuantity*this.precisionFactor)/this.precisionFactor}}this.product.canBuy=t.PRODUCT.CAN_BUY;this.product.canSubscription=t.PRODUCT.SUBSCRIPTION;this.canBuy=this.product.canBuy;this.canSubscription=this.product.canSubscription;this.product.name=t.PRODUCT.NAME;this.product.pict=t.PRODUCT.PICT;this.product.id=t.PRODUCT.ID;if(!!t.PRODUCT.ADD_URL){this.product.addUrl=t.PRODUCT.ADD_URL}if(!!t.PRODUCT.BUY_URL){this.product.buyUrl=t.PRODUCT.BUY_URL}if(!!t.BASKET&&"object"===typeof t.BASKET){this.basketData.useProps=!!t.BASKET.ADD_PROPS;this.basketData.emptyProps=!!t.BASKET.EMPTY_PROPS}}else{this.errorCode=-1}break;case 3:if(!!t.OFFERS&&BX.type.isArray(t.OFFERS)){if(!!t.PRODUCT&&"object"===typeof t.PRODUCT){this.product.name=t.PRODUCT.NAME;this.product.id=t.PRODUCT.ID}this.offers=t.OFFERS;this.offerNum=0;if(!!t.OFFER_SELECTED){this.offerNum=parseInt(t.OFFER_SELECTED,10)}if(isNaN(this.offerNum)){this.offerNum=0}if(!!t.TREE_PROPS){this.treeProps=t.TREE_PROPS}if(!!t.DEFAULT_PICTURE){this.defaultPict.pict=t.DEFAULT_PICTURE.PICTURE;this.defaultPict.secondPict=t.DEFAULT_PICTURE.PICTURE_SECOND}}else{this.errorCode=-1}break;default:this.errorCode=-1}if(!!t.BASKET&&"object"===typeof t.BASKET){if(!!t.BASKET.QUANTITY){this.basketData.quantity=t.BASKET.QUANTITY}if(!!t.BASKET.PROPS){this.basketData.props=t.BASKET.PROPS}if(!!t.BASKET.BASKET_URL){this.basketData.basketUrl=t.BASKET.BASKET_URL}}this.lastElement=!!t.LAST_ELEMENT&&"Y"===t.LAST_ELEMENT}if(0===this.errorCode){BX.ready(BX.delegate(this.Init,this))}};t.JCSaleGiftBasket.prototype.Init=function(){var e=0,s="",i=null;this.obProduct=BX(this.visual.ID);if(!this.obProduct){this.errorCode=-1}this.obPict=BX(this.visual.PICT_ID);if(!this.obPict){this.errorCode=-2}if(this.secondPict&&!!this.visual.SECOND_PICT_ID){this.obSecondPict=BX(this.visual.SECOND_PICT_ID)}this.obPrice=BX(this.visual.PRICE_ID);if(!this.obPrice){this.errorCode=-16}if(this.showQuantity&&!!this.visual.QUANTITY_ID){this.obQuantity=BX(this.visual.QUANTITY_ID);if(!!this.visual.QUANTITY_UP_ID){this.obQuantityUp=BX(this.visual.QUANTITY_UP_ID)}if(!!this.visual.QUANTITY_DOWN_ID){this.obQuantityDown=BX(this.visual.QUANTITY_DOWN_ID)}}if(3===this.productType){if(!!this.visual.TREE_ID){this.obTree=BX(this.visual.TREE_ID);if(!this.obTree){this.errorCode=-256}s=this.visual.TREE_ITEM_ID;for(e=0;e<this.treeProps.length;e++){this.obTreeRows[e]={LEFT:BX(s+this.treeProps[e].ID+"_left"),RIGHT:BX(s+this.treeProps[e].ID+"_right"),LIST:BX(s+this.treeProps[e].ID+"_list"),CONT:BX(s+this.treeProps[e].ID+"_cont")};if(!this.obTreeRows[e].LEFT||!this.obTreeRows[e].RIGHT||!this.obTreeRows[e].LIST||!this.obTreeRows[e].CONT){this.errorCode=-512;break}}}if(!!this.visual.QUANTITY_MEASURE){this.obMeasure=BX(this.visual.QUANTITY_MEASURE)}}if(!!this.visual.BUY_ID){this.obBuyBtn=BX(this.visual.BUY_ID)}if(this.showPercent){if(!!this.visual.DSC_PERC){this.obDscPerc=BX(this.visual.DSC_PERC)}if(this.secondPict&&!!this.visual.SECOND_DSC_PERC){this.obSecondDscPerc=BX(this.visual.SECOND_DSC_PERC)}}if(this.showSkuProps){if(!!this.visual.DISPLAY_PROP_DIV){this.obSkuProps=BX(this.visual.DISPLAY_PROP_DIV)}}if(0===this.errorCode){if(this.showQuantity){if(!!this.obQuantityUp){BX.bind(this.obQuantityUp,"click",BX.delegate(this.QuantityUp,this))}if(!!this.obQuantityDown){BX.bind(this.obQuantityDown,"click",BX.delegate(this.QuantityDown,this))}if(!!this.obQuantity){BX.bind(this.obQuantity,"change",BX.delegate(this.QuantityChange,this))}}switch(this.productType){case 1:break;case 3:i=BX.findChildren(this.obTree,{tagName:"li"},true);if(!!i&&0<i.length){for(e=0;e<i.length;e++){BX.bind(i[e],"click",BX.delegate(this.SelectOfferProp,this))}}for(e=0;e<this.obTreeRows.length;e++){BX.bind(this.obTreeRows[e].LEFT,"click",BX.delegate(this.RowLeft,this));BX.bind(this.obTreeRows[e].RIGHT,"click",BX.delegate(this.RowRight,this))}this.SetCurrent();break}if(!!this.obBuyBtn){BX.bind(this.obBuyBtn,"click",BX.delegate(this.Basket,this))}if(this.lastElement){this.containerHeight=parseInt(this.obProduct.parentNode.offsetHeight,10);if(isNaN(this.containerHeight)){this.containerHeight=0}this.setHeight();BX.bind(t,"resize",BX.delegate(this.checkHeight,this));BX.bind(this.obProduct.parentNode,"mouseover",BX.delegate(this.setHeight,this));BX.bind(this.obProduct.parentNode,"mouseout",BX.delegate(this.clearHeight,this))}}};t.JCSaleGiftBasket.prototype.checkHeight=function(){this.containerHeight=parseInt(this.obProduct.parentNode.offsetHeight,10);if(isNaN(this.containerHeight)){this.containerHeight=0}};t.JCSaleGiftBasket.prototype.setHeight=function(){if(0<this.containerHeight){BX.adjust(this.obProduct.parentNode,{style:{height:this.containerHeight+"px"}})}};t.JCSaleGiftBasket.prototype.clearHeight=function(){BX.adjust(this.obProduct.parentNode,{style:{height:"auto"}})};t.JCSaleGiftBasket.prototype.QuantityUp=function(){var t=0,e=true;if(0===this.errorCode&&this.showQuantity&&this.canBuy){t=this.isDblQuantity?parseFloat(this.obQuantity.value):parseInt(this.obQuantity.value,10);if(!isNaN(t)){t+=this.stepQuantity;if(this.checkQuantity){if(t>this.maxQuantity){e=false}}if(e){if(this.isDblQuantity){t=Math.round(t*this.precisionFactor)/this.precisionFactor}this.obQuantity.value=t}}}};t.JCSaleGiftBasket.prototype.QuantityDown=function(){var t=0,e=true;if(0===this.errorCode&&this.showQuantity&&this.canBuy){t=this.isDblQuantity?parseFloat(this.obQuantity.value):parseInt(this.obQuantity.value,10);if(!isNaN(t)){t-=this.stepQuantity;if(t<this.stepQuantity){e=false}if(e){if(this.isDblQuantity){t=Math.round(t*this.precisionFactor)/this.precisionFactor}this.obQuantity.value=t}}}};t.JCSaleGiftBasket.prototype.QuantityChange=function(){var t=0,e=true;if(0===this.errorCode&&this.showQuantity){if(this.canBuy){t=this.isDblQuantity?parseFloat(this.obQuantity.value):parseInt(this.obQuantity.value,10);if(!isNaN(t)){if(this.checkQuantity){if(t>this.maxQuantity){e=false;t=this.maxQuantity}else if(t<this.stepQuantity){e=false;t=this.stepQuantity}}if(!e){this.obQuantity.value=t}}else{this.obQuantity.value=this.stepQuantity}}else{this.obQuantity.value=this.stepQuantity}}};t.JCSaleGiftBasket.prototype.QuantitySet=function(t){if(0===this.errorCode){this.canBuy=this.offers[t].CAN_BUY;if(this.canBuy){BX.addClass(this.obBuyBtn,"bx_bt_button");BX.removeClass(this.obBuyBtn,"bx_bt_button_type_2");this.obBuyBtn.innerHTML=BX.message("CVP_MESS_BTN_BUY")}else{BX.addClass(this.obBuyBtn,"bx_bt_button_type_2");BX.removeClass(this.obBuyBtn,"bx_bt_button");this.obBuyBtn.innerHTML=BX.message("CVP_MESS_NOT_AVAILABLE")}if(this.showQuantity){this.isDblQuantity=this.offers[t].QUANTITY_FLOAT;this.checkQuantity=this.offers[t].CHECK_QUANTITY;if(this.isDblQuantity){this.maxQuantity=parseFloat(this.offers[t].MAX_QUANTITY);this.stepQuantity=Math.round(parseFloat(this.offers[t].STEP_QUANTITY)*this.precisionFactor)/this.precisionFactor}else{this.maxQuantity=parseInt(this.offers[t].MAX_QUANTITY,10);this.stepQuantity=parseInt(this.offers[t].STEP_QUANTITY,10)}this.obQuantity.value=this.stepQuantity;this.obQuantity.disabled=!this.canBuy;if(!!this.obMeasure){if(!!this.offers[t].MEASURE){BX.adjust(this.obMeasure,{html:this.offers[t].MEASURE})}else{BX.adjust(this.obMeasure,{html:""})}}}}};t.JCSaleGiftBasket.prototype.SelectOfferProp=function(){var t=0,e="",s="",i=[],a=null,o=BX.proxy_context;if(!!o&&o.hasAttribute("data-treevalue")){s=o.getAttribute("data-treevalue");i=s.split("_");if(this.SearchOfferPropIndex(i[0],i[1])){a=BX.findChildren(o.parentNode,{tagName:"li"},false);if(!!a&&0<a.length){for(t=0;t<a.length;t++){e=a[t].getAttribute("data-onevalue");if(e===i[1]){BX.addClass(a[t],"bx_active")}else{BX.removeClass(a[t],"bx_active")}}}}}};t.JCSaleGiftBasket.prototype.SearchOfferPropIndex=function(t,e){var s="",i=false,a,o,h=[],r=-1,n={},u=[];for(a=0;a<this.treeProps.length;a++){if(this.treeProps[a].ID===t){r=a;break}}if(-1<r){for(a=0;a<r;a++){s="PROP_"+this.treeProps[a].ID;n[s]=this.selectedValues[s]}s="PROP_"+this.treeProps[r].ID;i=this.GetRowValues(n,s);if(!i){return false}if(!BX.util.in_array(e,i)){return false}n[s]=e;for(a=r+1;a<this.treeProps.length;a++){s="PROP_"+this.treeProps[a].ID;i=this.GetRowValues(n,s);if(!i){return false}if(this.showAbsent){h=[];u=[];u=BX.clone(n,true);for(o=0;o<i.length;o++){u[s]=i[o];if(this.GetCanBuy(u)){h[h.length]=i[o]}}}else{h=i}if(!!this.selectedValues[s]&&BX.util.in_array(this.selectedValues[s],h)){n[s]=this.selectedValues[s]}else{n[s]=h[0]}this.UpdateRow(a,n[s],i,h)}this.selectedValues=n;this.ChangeInfo()}return true};t.JCSaleGiftBasket.prototype.RowLeft=function(){var t=0,e="",s=-1,i=BX.proxy_context;if(!!i&&i.hasAttribute("data-treevalue")){e=i.getAttribute("data-treevalue");for(t=0;t<this.treeProps.length;t++){if(this.treeProps[t].ID===e){s=t;break}}if(-1<s&&this.treeRowShowSize<this.showCount[s]){if(0>this.showStart[s]){this.showStart[s]++;BX.adjust(this.obTreeRows[s].LIST,{style:{marginLeft:this.showStart[s]*20+"%"}});BX.adjust(this.obTreeRows[s].RIGHT,{style:this.treeEnableArrow})}if(0<=this.showStart[s]){BX.adjust(this.obTreeRows[s].LEFT,{style:this.treeDisableArrow})}}}};t.JCSaleGiftBasket.prototype.RowRight=function(){var t=0,e="",s=-1,i=BX.proxy_context;if(!!i&&i.hasAttribute("data-treevalue")){e=i.getAttribute("data-treevalue");for(t=0;t<this.treeProps.length;t++){if(this.treeProps[t].ID===e){s=t;break}}if(-1<s&&this.treeRowShowSize<this.showCount[s]){if(this.treeRowShowSize-this.showStart[s]<this.showCount[s]){this.showStart[s]--;BX.adjust(this.obTreeRows[s].LIST,{style:{marginLeft:this.showStart[s]*20+"%"}});BX.adjust(this.obTreeRows[s].LEFT,{style:this.treeEnableArrow})}if(this.treeRowShowSize-this.showStart[s]>=this.showCount[s]){BX.adjust(this.obTreeRows[s].RIGHT,{style:this.treeDisableArrow})}}}};t.JCSaleGiftBasket.prototype.UpdateRow=function(t,e,s,i){var a=0,o=0,h="",r=0,n="",u={},l=false,f=false,c=false,p=0,b=this.treeEnableArrow,P=this.treeEnableArrow,d=0,T=null;if(-1<t&&t<this.obTreeRows.length){T=BX.findChildren(this.obTreeRows[t].LIST,{tagName:"li"},false);if(!!T&&0<T.length){l="PICT"===this.treeProps[t].SHOW_MODE;r=s.length;f=this.treeRowShowSize<r;n=f?100/r+"%":"20%";u={props:{className:""},style:{width:n}};if(l){u.style.paddingTop=n}for(a=0;a<T.length;a++){h=T[a].getAttribute("data-onevalue");c=h===e;if(BX.util.in_array(h,i)){u.props.className=c?"bx_active":""}else{u.props.className=c?"bx_active bx_missing":"bx_missing"}u.style.display="none";if(BX.util.in_array(h,s)){u.style.display="";if(c){p=o}o++}BX.adjust(T[a],u)}u={style:{width:(f?20*r:100)+"%",marginLeft:"0%"}};if(l){BX.adjust(this.obTreeRows[t].CONT,{props:{className:f?"bx_item_detail_scu full":"bx_item_detail_scu"}})}else{BX.adjust(this.obTreeRows[t].CONT,{props:{className:f?"bx_item_detail_size full":"bx_item_detail_size"}})}if(f){if(p+1===r){P=this.treeDisableArrow}if(this.treeRowShowSize<=p){d=this.treeRowShowSize-p-1;u.style.marginLeft=d*20+"%"}if(0===d){b=this.treeDisableArrow}BX.adjust(this.obTreeRows[t].LEFT,{style:b});BX.adjust(this.obTreeRows[t].RIGHT,{style:P})}else{BX.adjust(this.obTreeRows[t].LEFT,{style:{display:"none"}});BX.adjust(this.obTreeRows[t].RIGHT,{style:{display:"none"}})}BX.adjust(this.obTreeRows[t].LIST,u);this.showCount[t]=r;this.showStart[t]=d}}};t.JCSaleGiftBasket.prototype.GetRowValues=function(t,e){var s=0,i,a=[],o=false,h=true;if(0===t.length){for(s=0;s<this.offers.length;s++){if(!BX.util.in_array(this.offers[s].TREE[e],a)){a[a.length]=this.offers[s].TREE[e]}}o=true}else{for(s=0;s<this.offers.length;s++){h=true;for(i in t){if(t[i]!==this.offers[s].TREE[i]){h=false;break}}if(h){if(!BX.util.in_array(this.offers[s].TREE[e],a)){a[a.length]=this.offers[s].TREE[e]}o=true}}}return o?a:false};t.JCSaleGiftBasket.prototype.GetCanBuy=function(t){var e=0,s,i=false,a=true;for(e=0;e<this.offers.length;e++){a=true;for(s in t){if(t[s]!==this.offers[e].TREE[s]){a=false;break}}if(a){if(this.offers[e].CAN_BUY){i=true;break}}}return i};t.JCSaleGiftBasket.prototype.SetCurrent=function(){var t=0,e=0,s=[],i="",a=false,o={},h=[],r=this.offers[this.offerNum].TREE;for(t=0;t<this.treeProps.length;t++){i="PROP_"+this.treeProps[t].ID;a=this.GetRowValues(o,i);if(!a){break}if(BX.util.in_array(r[i],a)){o[i]=r[i]}else{o[i]=a[0];this.offerNum=0}if(this.showAbsent){s=[];h=[];h=BX.clone(o,true);for(e=0;e<a.length;e++){h[i]=a[e];if(this.GetCanBuy(h)){s[s.length]=a[e]}}}else{s=a}this.UpdateRow(t,o[i],a,s)}this.selectedValues=o;this.ChangeInfo()};t.JCSaleGiftBasket.prototype.ChangeInfo=function(){var t=0,e,s=-1,i={},a=true,o="";for(t=0;t<this.offers.length;t++){a=true;for(e in this.selectedValues){if(this.selectedValues[e]!==this.offers[t].TREE[e]){a=false;break}}if(a){s=t;break}}if(-1<s){if(!!this.obPict){if(!!this.offers[s].PREVIEW_PICTURE){BX.adjust(this.obPict,{style:{backgroundImage:"url("+this.offers[s].PREVIEW_PICTURE.SRC+")"}})}else{BX.adjust(this.obPict,{style:{backgroundImage:"url("+this.defaultPict.pict.SRC+")"}})}}if(this.secondPict&&!!this.obSecondPict){if(!!this.offers[s].PREVIEW_PICTURE_SECOND){BX.adjust(this.obSecondPict,{style:{backgroundImage:"url("+this.offers[s].PREVIEW_PICTURE_SECOND.SRC+")"}})}else if(!!this.offers[s].PREVIEW_PICTURE.SRC){BX.adjust(this.obSecondPict,{style:{backgroundImage:"url("+this.offers[s].PREVIEW_PICTURE.SRC+")"}})}else if(!!this.defaultPict.secondPict){BX.adjust(this.obSecondPict,{style:{backgroundImage:"url("+this.defaultPict.secondPict.SRC+")"}})}else{BX.adjust(this.obSecondPict,{style:{backgroundImage:"url("+this.defaultPict.pict.SRC+")"}})}}if(this.showSkuProps&&!!this.obSkuProps){if(0===this.offers[s].DISPLAY_PROPERTIES.length){BX.adjust(this.obSkuProps,{style:{display:"none"},html:""})}else{BX.adjust(this.obSkuProps,{style:{display:""},html:this.offers[s].DISPLAY_PROPERTIES})}}if(!!this.obPrice){o=this.offers[s].PRICE.PRINT_DISCOUNT_VALUE;if(this.showOldPrice&&this.offers[s].PRICE.DISCOUNT_VALUE!==this.offers[s].PRICE.VALUE){o+=" <span>"+this.offers[s].PRICE.PRINT_VALUE+"</span>"}BX.adjust(this.obPrice,{html:o});if(this.showPercent){if(this.offers[s].PRICE.DISCOUNT_VALUE!==this.offers[s].PRICE.VALUE){i={style:{display:""},html:this.offers[s].PRICE.DISCOUNT_DIFF_PERCENT}}else{i={style:{display:"none"},html:""}}if(!!this.obDscPerc){BX.adjust(this.obDscPerc,i)}if(!!this.obSecondDscPerc){BX.adjust(this.obSecondDscPerc,i)}}}this.offerNum=s;this.QuantitySet(this.offerNum)}};t.JCSaleGiftBasket.prototype.InitBasketUrl=function(){switch(this.productType){case 1:case 2:this.basketUrl=this.product.addUrl;break;case 3:this.basketUrl=this.offers[this.offerNum].ADD_URL;break}this.basketParams={ajax_basket:"Y"};if(this.showQuantity){this.basketParams[this.basketData.quantity]=this.obQuantity.value}};t.JCSaleGiftBasket.prototype.FillBasketProps=function(){if(!this.visual.BASKET_PROP_DIV){return}var t=0,e=null,s=false,i=null;if(this.basketData.useProps&&!this.basketData.emptyProps){if(!!this.obPopupWin&&!!this.obPopupWin.contentContainer){i=this.obPopupWin.contentContainer}}else{i=BX(this.visual.BASKET_PROP_DIV)}if(!i){return}e=i.getElementsByTagName("select");if(!!e&&!!e.length){for(t=0;t<e.length;t++){if(!e[t].disabled){switch(e[t].type.toLowerCase()){case"select-one":this.basketParams[e[t].name]=e[t].value;s=true;break;default:break}}}}e=i.getElementsByTagName("input");if(!!e&&!!e.length){for(t=0;t<e.length;t++){if(!e[t].disabled){switch(e[t].type.toLowerCase()){case"hidden":this.basketParams[e[t].name]=e[t].value;s=true;break;case"radio":if(e[t].checked){this.basketParams[e[t].name]=e[t].value;s=true}break;default:break}}}}if(!s){this.basketParams[this.basketData.props]=[];this.basketParams[this.basketData.props][0]=0}};t.JCSaleGiftBasket.prototype.SendToBasket=function(){if(!this.canBuy){return}this.InitBasketUrl();this.FillBasketProps();BX.ajax.loadJSON(this.basketUrl,this.basketParams,BX.delegate(this.BasketResult,this))};t.JCSaleGiftBasket.prototype.Basket=function(){var t="";if(!this.canBuy){return}switch(this.productType){case 1:case 2:if(this.basketData.useProps&&!this.basketData.emptyProps){this.InitPopupWindow();this.obPopupWin.setTitleBar({content:BX.create("div",{style:{marginRight:"30px",whiteSpace:"nowrap"},text:BX.message("CVP_TITLE_BASKET_PROPS")})});if(BX(this.visual.BASKET_PROP_DIV)){t=BX(this.visual.BASKET_PROP_DIV).innerHTML}this.obPopupWin.setContent(t);this.obPopupWin.setButtons([new e({ownerClass:this.obProduct.parentNode.parentNode.parentNode.className,text:BX.message("CVP_BTN_MESSAGE_SEND_PROPS"),events:{click:BX.delegate(this.SendToBasket,this)}})]);this.obPopupWin.show()}else{this.SendToBasket()}break;case 3:this.SendToBasket();break}};t.JCSaleGiftBasket.prototype.BasketResult=function(t){var s="",i="",a="",o=true,h=[];if(!!this.obPopupWin){this.obPopupWin.close()}if("object"!==typeof t){return false}o="OK"===t.STATUS;if(o){BX.reload();return;BX.onCustomEvent("OnBasketChange");i=this.product.name;switch(this.productType){case 1:case 2:a=this.product.pict.SRC;break;case 3:a=!!this.offers[this.offerNum].PREVIEW_PICTURE?this.offers[this.offerNum].PREVIEW_PICTURE.SRC:this.defaultPict.pict.SRC;break}s='<div style="width: 96%; margin: 10px 2%; text-align: center;"><img src="'+a+'" height="130" style="max-height:130px"><p>'+i+"</p></div>";h=[new e({ownerClass:this.obProduct.parentNode.parentNode.parentNode.className,text:BX.message("CVP_BTN_MESSAGE_BASKET_REDIRECT"),events:{click:BX.delegate(function(){location.href=!!this.basketData.basketUrl?this.basketData.basketUrl:BX.message("CVP_BASKET_URL")},this)}})]}else{s=!!t.MESSAGE?t.MESSAGE:BX.message("CVP_BASKET_UNKNOWN_ERROR");h=[new e({ownerClass:this.obProduct.parentNode.parentNode.parentNode.className,text:BX.message("CVP_BTN_MESSAGE_CLOSE"),events:{click:BX.delegate(this.obPopupWin.close,this.obPopupWin)}})]}this.InitPopupWindow();this.obPopupWin.setTitleBar({content:BX.create("div",{style:{marginRight:"30px",whiteSpace:"nowrap"},text:o?BX.message("CVP_TITLE_SUCCESSFUL"):BX.message("CVP_TITLE_ERROR")})});this.obPopupWin.setContent(s);this.obPopupWin.setButtons(h);this.obPopupWin.show()};t.JCSaleGiftBasket.prototype.InitPopupWindow=function(){if(!!this.obPopupWin){return}this.obPopupWin=BX.PopupWindowManager.create("CatalogSectionBasket_"+this.visual.ID,null,{autoHide:false,offsetLeft:0,offsetTop:0,overlay:true,closeByEsc:true,titleBar:true,closeIcon:{top:"10px",right:"10px"}})}})(window);
/* End */
;; /* /bitrix/components/bitrix/sale.basket.basket/templates/.default/script.min.js?150591127522417*/
; /* /bitrix/components/bitrix/sale.gift.basket/templates/.default/script.min.js?150591127521315*/

//# sourceMappingURL=page_f7a198fbc355c12ee362ab9e263e6a9b.map.js